<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Games - Language Learning Hub</title>
    <link rel="stylesheet" href="./css/styles.css">
</head>
<body class="theme-purple page-home">
    <div class="container">
        <h1>üéÆ English Games</h1>
        <p class="subtitle">Interactive Language Learning Hub</p>
        
        <div class="description">
            üéØ Welcome to English Games! Practice and improve your English skills through fun, interactive games. 
            Choose from different difficulty levels and track your progress as you learn.
        </div>

        <div class="games-grid" id="gamesGrid">
            <!-- Games will be loaded dynamically -->
            <div style="text-align: center; padding: 40px; grid-column: 1 / -1;">
                <p>Loading games...</p>
            </div>
        </div>

        <div class="footer">
            <p>üöÄ Start your English learning journey today! Each game tracks your progress and adapts to your level.</p>
            <p>Made with ‚ù§Ô∏è for language learners</p>
        </div>
    </div>

    <script>
        // Load all games dynamically from JSON files
        let availableGames = [];

        async function loadGames() {
            const gamesGrid = document.getElementById('gamesGrid');
            
            try {
                // Fetch list of game JSON files dynamically
                const response = await fetch('./games/');
                const text = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(text, 'text/html');
                const links = Array.from(doc.querySelectorAll('a'));
                const gameFiles = links
                    .map(link => link.href.split('/').pop())
                    .filter(file => file.endsWith('.json'))
                    .map(file => file.replace('.json', ''));
                
                // Load each game configuration
                for (const gameId of gameFiles) {
                    try {
                        const response = await fetch(`./games/${gameId}.json`);
                        if (response.ok) {
                            const gameConfig = await response.json();
                            availableGames.push(gameConfig);
                        }
                    } catch (error) {
                        console.error(`Error loading ${gameId}:`, error);
                    }
                }
                
                // Clear loading message
                gamesGrid.innerHTML = '';
                
                // Render game cards
                availableGames.forEach(game => {
                    const gameCard = createGameCard(game);
                    gamesGrid.appendChild(gameCard);
                });
                
                // Add "coming soon" cards
                addComingSoonCards(gamesGrid);
                
                // Animate cards
                animateCards();
                
            } catch (error) {
                console.error('Error loading games:', error);
                gamesGrid.innerHTML = '<div style="text-align: center; padding: 40px; grid-column: 1 / -1;"><p>Error loading games. Please refresh the page.</p></div>';
            }
        }

        function createGameCard(game) {
            const card = document.createElement('div');
            card.className = 'game-card';
            card.onclick = () => playGame(game.id, game.component);
            
            const difficultyCount = game.difficulties ? game.difficulties.length : (game.modes ? game.modes.length : 0);
            const levelIndicators = Array(difficultyCount).fill('<div class="level-indicator"></div>').join('');
            
            let subtitle = '';
            if (game.difficulties && game.difficulties.length > 0) {
                const firstDiff = game.difficulties[0];
                const lastDiff = game.difficulties[game.difficulties.length - 1];
                
                if (game.conversionType === 'ordinal') {
                    subtitle = `Ordinal numbers from ${firstDiff.min}${getOrdinalSuffix(firstDiff.min)} to ${lastDiff.max}${getOrdinalSuffix(lastDiff.max)}`;
                } else if (game.conversionType === 'cardinal') {
                    subtitle = `Numbers from ${firstDiff.min.toLocaleString()} to ${lastDiff.max.toLocaleString()}`;
                }
            } else if (game.component === 'sentence.component') {
                subtitle = 'Contextual sentence practice';
            }
            
            card.innerHTML = `
                <span class="game-icon">${game.icon}</span>
                <h3 class="game-title">${game.title}</h3>
                <p class="game-description">
                    ${game.subtitle || game.description}
                </p>
                <div class="difficulty-label">${difficultyCount} ${difficultyCount === 1 ? 'Mode' : 'Modes'} Available</div>
                <div class="game-levels">
                    ${levelIndicators}
                </div>
                <small>${subtitle}</small>
            `;
            
            return card;
        }

        function getOrdinalSuffix(num) {
            const lastTwoDigits = num % 100;
            const lastDigit = num % 10;
            
            if (lastTwoDigits >= 11 && lastTwoDigits <= 13) {
                return 'th';
            }
            
            switch (lastDigit) {
                case 1: return 'st';
                case 2: return 'nd';
                case 3: return 'rd';
                default: return 'th';
            }
        }

        function addComingSoonCards(container) {
            const comingSoonGames = [
                { icon: 'üìö', title: 'Vocabulary Builder', description: 'Expand your vocabulary with word association games and definition matching.' },
                { icon: '‚è∞', title: 'Time & Dates', description: 'Practice telling time and writing dates in proper English format.' },
                { icon: 'üåç', title: 'Countries & Capitals', description: 'Learn countries, capitals, and nationalities in English.' },
                { icon: 'üî§', title: 'Spelling Challenge', description: 'Improve your spelling with audio-based word challenges.' }
            ];
            
            comingSoonGames.forEach(game => {
                const card = document.createElement('div');
                card.className = 'coming-soon-card';
                card.innerHTML = `
                    <div class="coming-soon-badge">Coming Soon</div>
                    <span class="game-icon">${game.icon}</span>
                    <h3 class="game-title">${game.title}</h3>
                    <p class="game-description">
                        ${game.description}
                    </p>
                `;
                container.appendChild(card);
            });
        }

        function playGame(gameId, component) {
            const targetCard = event.currentTarget;
            targetCard.style.transform = 'scale(0.95)';
            targetCard.style.opacity = '0.8';
            
            setTimeout(() => {
                window.location.href = `./components/${component}.html?game=${gameId}`;
            }, 150);
        }

        function animateCards() {
            const gameCards = document.querySelectorAll('.game-card');
            gameCards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(30px)';
                
                setTimeout(() => {
                    card.style.transition = 'all 0.6s ease';
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, index * 150);
            });
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadGames();
        });
    </script>
</body>
</html>