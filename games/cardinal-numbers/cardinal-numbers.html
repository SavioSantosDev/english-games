<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cardinal Numbers Game - English Practice</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 600px;
            width: 100%;
        }

        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        .range-selector {
            margin: 30px 0;
        }

        .range-option {
            background: #f5f5f5;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .range-option:hover {
            background: #667eea;
            border-color: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .range-option h3 {
            font-size: 1.3em;
            margin-bottom: 5px;
        }

        .range-option p {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .game-area {
            text-align: center;
        }

        .score-board {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 10px;
        }

        .score-item {
            text-align: center;
        }

        .score-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .score-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #667eea;
        }

        .number-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 4em;
            font-weight: bold;
            padding: 40px;
            border-radius: 15px;
            margin: 30px 0;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .input-group {
            margin: 30px 0;
        }

        input[type="text"] {
            width: 100%;
            padding: 15px 20px;
            font-size: 1.2em;
            border: 2px solid #ddd;
            border-radius: 10px;
            outline: none;
            transition: border-color 0.3s ease;
        }

        input[type="text"]:focus {
            border-color: #667eea;
        }

        .feedback {
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            font-weight: bold;
            text-align: center;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .feedback.correct {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .feedback.incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .feedback.hidden {
            opacity: 0;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            font-weight: bold;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .secondary-button {
            background: #6c757d;
        }

        .instruction {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            color: #004085;
            border-left: 4px solid #667eea;
        }

        .speech-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1em;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            font-weight: bold;
            margin: 0 10px 15px 10px;
            min-width: 180px;
        }

        .speech-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .speech-button:active {
            transform: translateY(0);
        }

        .speech-button.recording {
            background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        #listeningInput {
            width: 100%;
            padding: 15px 20px;
            font-size: 1.2em;
            border: 2px solid #ddd;
            border-radius: 10px;
            outline: none;
            transition: border-color 0.3s ease;
        }

        #listeningInput:focus {
            border-color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Tela Inicial -->
        <div id="startScreen" class="screen active">
            <h1>üéÆ Cardinal Numbers</h1>
            <p class="subtitle">Practice English Numbers</p>
            
            <div class="instruction">
                üéØ Choose your practice mode:
            </div>

            <div class="range-selector">
                <div class="range-option" onclick="showModeScreen('writing')">
                    <h3>‚úçÔ∏è Writing Mode</h3>
                    <p>See numbers and write them in English</p>
                </div>
                
                <div class="range-option" onclick="showModeScreen('speaking')">
                    <h3>üó£Ô∏è Speaking Mode</h3>
                    <p>See numbers and speak them aloud</p>
                </div>
                
                <div class="range-option" onclick="showModeScreen('listening')">
                    <h3>üëÇ Listening Mode</h3>
                    <p>Listen to numbers and write what you hear</p>
                </div>
            </div>

            <div class="button-group">
                <button class="secondary-button" onclick="backToMainMenu()">‚Üê Back to Main Menu</button>
            </div>
        </div>

        <!-- Tela de Sele√ß√£o de Dificuldade -->
        <div id="difficultyScreen" class="screen">
            <h1>üéÆ Cardinal Numbers</h1>
            <p class="subtitle" id="modeTitle">Writing Mode</p>
            
            <div class="instruction" id="modeInstruction">
                üìù Choose a number range and write the numbers in English!
            </div>

            <div class="range-selector">
                <div class="range-option" onclick="startGame(1, 20)">
                    <h3>üü¢ Easy</h3>
                    <p>Numbers from 1 to 20</p>
                </div>
                
                <div class="range-option" onclick="startGame(1, 100)">
                    <h3>üü° Medium</h3>
                    <p>Numbers from 1 to 100</p>
                </div>
                
                <div class="range-option" onclick="startGame(1, 999999)">
                    <h3>üî¥ Hard</h3>
                    <p>Numbers from 1 to 999,999</p>
                </div>
                
                <div class="range-option" onclick="startGame(1, 999999999)">
                    <h3>üî• Expert</h3>
                    <p>Numbers from 1 to 999,999,999</p>
                </div>
            </div>

            <div class="button-group">
                <button class="secondary-button" onclick="backToStart()">‚Üê Back to Modes</button>
                <button class="secondary-button" onclick="backToMainMenu()">‚Üê Main Menu</button>
            </div>
        </div>

        <!-- Tela do Jogo -->
        <div id="gameScreen" class="screen">
            <h1>üéÆ Cardinal Numbers</h1>
            
            <div class="score-board">
                <div class="score-item">
                    <div class="score-label">Correct</div>
                    <div class="score-value" id="correctScore">0</div>
                </div>
                <div class="score-item">
                    <div class="score-label">Incorrect</div>
                    <div class="score-value" id="incorrectScore" style="color: #dc3545;">0</div>
                </div>
                <div class="score-item">
                    <div class="score-label">Total</div>
                    <div class="score-value" id="totalScore" style="color: #6c757d;">0</div>
                </div>
            </div>

            <div class="instruction" id="gameInstruction">
                Write the number below in English and press Enter.<br>
                <small style="opacity: 0.8;">Keep trying until you get it right!</small>
            </div>

            <div class="number-display" id="numberDisplay">0</div>

            <!-- Speaking Mode Controls -->
            <div id="speakingControls" class="input-group" style="display: none;">
                <button id="startSpeaking" onclick="startSpeechRecognition()" class="speech-button">üé§ Start Speaking</button>
                <button id="playAudio" onclick="playNumberAudio()" class="speech-button">üîä Repeat Number</button>
            </div>

            <!-- Listening Mode Controls -->
            <div id="listeningControls" class="input-group" style="display: none;">
                <button id="playListening" onclick="playNumberAudio()" class="speech-button">üîä Play Number</button>
                <div style="margin-top: 15px;">
                    <input 
                        type="text" 
                        id="listeningInput" 
                        placeholder="Type what you heard..." 
                        autocomplete="off"
                        onkeypress="handleKeyPress(event)"
                    >
                </div>
            </div>

            <!-- Writing Mode Controls (existing) -->
            <div id="writingControls" class="input-group">
                <input 
                    type="text" 
                    id="answerInput" 
                    placeholder="Type the number in English..." 
                    autocomplete="off"
                    onkeypress="handleKeyPress(event)"
                >
            </div>

            <div id="feedback" class="feedback hidden"></div>

            <div class="button-group">
                <button id="checkBtn" onclick="checkAnswer()">‚úì Check Answer</button>
                <button id="nextBtn" onclick="generateNewNumber()" style="display: none;">‚Üí Next Number</button>
                <button class="secondary-button" onclick="backToDifficulty()">‚Üê Back to Difficulty</button>
                <button class="secondary-button" onclick="backToMainMenu()">‚Üê Main Menu</button>
            </div>
        </div>
    </div>

    <script>
        let currentNumber = 0;
        let minRange = 1;
        let maxRange = 20;
        let correctCount = 0;
        let incorrectCount = 0;
        let totalCount = 0;
        let currentAnswer = '';
        let gameMode = 'writing'; // 'writing', 'speaking', 'listening'
        let speechSynthesis = window.speechSynthesis;
        let recognition = null;

        function numberToWords(num) {
            const ones = ['', 'one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight', 'nine'];
            const teens = ['ten', 'eleven', 'twelve', 'thirteen', 'fourteen', 'fifteen', 'sixteen', 'seventeen', 'eighteen', 'nineteen'];
            const tens = ['', '', 'twenty', 'thirty', 'forty', 'fifty', 'sixty', 'seventy', 'eighty', 'ninety'];
            
            if (num === 0) return 'zero';
            
            if (num < 10) return ones[num];
            if (num < 20) return teens[num - 10];
            if (num < 100) {
                return tens[Math.floor(num / 10)] + (num % 10 !== 0 ? '-' + ones[num % 10] : '');
            }
            if (num < 1000) {
                const hundreds = Math.floor(num / 100);
                const remainder = num % 100;
                const hundredText = hundreds === 1 ? 'a hundred' : ones[hundreds] + ' hundred';
                return hundredText + (remainder !== 0 ? ' and ' + numberToWords(remainder) : '');
            }
            if (num < 1000000) {
                const thousands = Math.floor(num / 1000);
                const remainder = num % 1000;
                const thousandText = thousands === 1 ? 'a thousand' : numberToWords(thousands) + ' thousand';
                return thousandText + (remainder !== 0 ? ' ' + numberToWords(remainder) : '');
            }
            if (num < 1000000000) {
                const millions = Math.floor(num / 1000000);
                const remainder = num % 1000000;
                const millionText = millions === 1 ? 'a million' : numberToWords(millions) + ' million';
                return millionText + (remainder !== 0 ? ' ' + numberToWords(remainder) : '');
            }
            
            return num.toString();
        }

        function getRandomNumber(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function getSmartRandomNumber(min, max) {
            // Para ranges pequenos, usar distribui√ß√£o normal
            if (max <= 100) {
                return getRandomNumber(min, max);
            }
            
            // Para ranges maiores, usar distribui√ß√£o ponderada
            const rand = Math.random();
            
            if (max <= 999999) { // Hard mode
                if (rand < 0.15) {
                    // 15% - Unidades e dezenas (1-99)
                    return getRandomNumber(1, Math.min(99, max));
                } else if (rand < 0.35) {
                    // 20% - Centenas (100-999)
                    return getRandomNumber(100, Math.min(999, max));
                } else if (rand < 0.70) {
                    // 35% - Milhares (1000-99999)
                    return getRandomNumber(1000, Math.min(99999, max));
                } else {
                    // 30% - Dezenas/centenas de milhares (100000-999999)
                    return getRandomNumber(100000, max);
                }
            } else { // Expert mode
                if (rand < 0.10) {
                    // 10% - Unidades e dezenas (1-99)
                    return getRandomNumber(1, 99);
                } else if (rand < 0.15) {
                    // 5% - Centenas (100-999)
                    return getRandomNumber(100, 999);
                } else if (rand < 0.30) {
                    // 15% - Milhares (1000-99999)
                    return getRandomNumber(1000, 99999);
                } else if (rand < 0.60) {
                    // 30% - Centenas de milhares (100000-999999)
                    return getRandomNumber(100000, 999999);
                } else if (rand < 0.85) {
                    // 25% - Milh√µes (1000000-99999999)
                    return getRandomNumber(1000000, 99999999);
                } else {
                    // 15% - Centenas de milh√µes (100000000-999999999)
                    return getRandomNumber(100000000, max);
                }
            }
        }

        function startGame(min, max) {
            minRange = min;
            maxRange = max;
            correctCount = 0;
            incorrectCount = 0;
            totalCount = 0;
            
            updateScores();
            showScreen('gameScreen');
            setupGameMode();
            generateNewNumber();
        }

        function generateNewNumber() {
            currentNumber = getSmartRandomNumber(minRange, maxRange);
            currentAnswer = numberToWords(currentNumber);
            document.getElementById('numberDisplay').textContent = currentNumber.toLocaleString();
            
            // Clear inputs based on mode
            if (gameMode === 'writing') {
                document.getElementById('answerInput').value = '';
                document.getElementById('answerInput').focus();
            } else if (gameMode === 'listening') {
                document.getElementById('listeningInput').value = '';
                document.getElementById('listeningInput').focus();
            }
            
            hideFeedback();
        }

        function normalizeAnswer(text) {
            return text.toLowerCase()
                .trim()
                .replace(/\s+/g, ' ')
                .replace(/,/g, '')
                .replace(/\band\b/g, 'and')
                // Normalizar varia√ß√µes de "a" vs "one"
                .replace(/\bone hundred\b/g, 'a hundred')
                .replace(/\bone thousand\b/g, 'a thousand')
                .replace(/\bone million\b/g, 'a million');
        }

        function checkAnswer() {
            let userAnswer = '';
            
            if (gameMode === 'writing') {
                userAnswer = document.getElementById('answerInput').value;
            } else if (gameMode === 'listening') {
                userAnswer = document.getElementById('listeningInput').value;
            } else {
                return; // Speaking mode doesn't use this function
            }
            
            const normalizedUser = normalizeAnswer(userAnswer);
            const normalizedCorrect = normalizeAnswer(currentAnswer);
            
            // Criar varia√ß√µes aceitas da resposta correta
            const acceptedAnswers = [normalizedCorrect];
            
            // Adicionar varia√ß√µes com "one" em vez de "a"
            const oneVariant = normalizedCorrect
                .replace(/\ba hundred\b/g, 'one hundred')
                .replace(/\ba thousand\b/g, 'one thousand')
                .replace(/\ba million\b/g, 'one million');
            
            if (oneVariant !== normalizedCorrect) {
                acceptedAnswers.push(oneVariant);
            }
            
            // For listening mode, also accept the numeric form
            if (gameMode === 'listening') {
                const numericAnswer = currentNumber.toString();
                acceptedAnswers.push(numericAnswer);
            }
            
            const feedbackElement = document.getElementById('feedback');
            
            if (acceptedAnswers.includes(normalizedUser) || (gameMode === 'listening' && userAnswer.trim() === currentNumber.toString())) {
                correctCount++;
                totalCount++;
                feedbackElement.textContent = '‚úì Correct! Well done!';
                feedbackElement.className = 'feedback correct';
                
                updateScores();
                
                setTimeout(() => {
                    generateNewNumber();
                }, 600);
            } else {
                incorrectCount++;
                totalCount++;
                
                // Mostrar ambas as varia√ß√µes aceitas se existirem
                let correctDisplay = acceptedAnswers.length > 1 
                    ? `"${acceptedAnswers[0]}" or "${acceptedAnswers[1]}"` 
                    : `"${acceptedAnswers[0]}"`;
                
                // Add numeric option for listening mode
                if (gameMode === 'listening') {
                    correctDisplay += ` or "${currentNumber}"`;
                }
                    
                feedbackElement.textContent = `‚úó Incorrect. The correct answer is: ${correctDisplay}. Try again!`;
                feedbackElement.className = 'feedback incorrect';
                
                updateScores();
                
                // Limpar o campo e manter o mesmo n√∫mero para nova tentativa
                setTimeout(() => {
                    if (gameMode === 'writing') {
                        document.getElementById('answerInput').value = '';
                        document.getElementById('answerInput').focus();
                    } else if (gameMode === 'listening') {
                        document.getElementById('listeningInput').value = '';
                        document.getElementById('listeningInput').focus();
                    }
                    hideFeedback();
                }, 2000);
            }
        }

        function updateScores() {
            document.getElementById('correctScore').textContent = correctCount;
            document.getElementById('incorrectScore').textContent = incorrectCount;
            document.getElementById('totalScore').textContent = totalCount;
        }

        function hideFeedback() {
            document.getElementById('feedback').className = 'feedback hidden';
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                checkAnswer();
            }
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        function showModeScreen(mode) {
            gameMode = mode;
            const modeTitle = document.getElementById('modeTitle');
            const modeInstruction = document.getElementById('modeInstruction');
            
            switch(mode) {
                case 'writing':
                    modeTitle.textContent = 'Writing Mode';
                    modeInstruction.innerHTML = '‚úçÔ∏è Choose a number range and write the numbers in English!';
                    break;
                case 'speaking':
                    modeTitle.textContent = 'Speaking Mode';
                    modeInstruction.innerHTML = 'üó£Ô∏è Choose a number range and speak the numbers aloud!';
                    break;
                case 'listening':
                    modeTitle.textContent = 'Listening Mode';
                    modeInstruction.innerHTML = 'üëÇ Choose a number range and listen to the numbers!';
                    break;
            }
            
            showScreen('difficultyScreen');
        }

        function setupGameMode() {
            const writingControls = document.getElementById('writingControls');
            const speakingControls = document.getElementById('speakingControls');
            const listeningControls = document.getElementById('listeningControls');
            const numberDisplay = document.getElementById('numberDisplay');
            const gameInstruction = document.getElementById('gameInstruction');
            const checkBtn = document.getElementById('checkBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            // Hide all controls first
            writingControls.style.display = 'none';
            speakingControls.style.display = 'none';
            listeningControls.style.display = 'none';
            
            switch(gameMode) {
                case 'writing':
                    writingControls.style.display = 'block';
                    numberDisplay.style.display = 'block';
                    gameInstruction.innerHTML = 'Write the number below in English and press Enter.<br><small style="opacity: 0.8;">Keep trying until you get it right!</small>';
                    checkBtn.style.display = 'inline-block';
                    nextBtn.style.display = 'none';
                    break;
                    
                case 'speaking':
                    speakingControls.style.display = 'block';
                    numberDisplay.style.display = 'block';
                    gameInstruction.innerHTML = 'Say the number shown below aloud.<br><small style="opacity: 0.8;">Click the microphone and speak clearly!</small>';
                    checkBtn.style.display = 'none';
                    nextBtn.style.display = 'inline-block';
                    setupSpeechRecognition();
                    break;
                    
                case 'listening':
                    listeningControls.style.display = 'block';
                    numberDisplay.style.display = 'none';
                    gameInstruction.innerHTML = 'Listen to the number and write what you hear.<br><small style="opacity: 0.8;">Click play to hear the number!</small>';
                    checkBtn.style.display = 'inline-block';
                    nextBtn.style.display = 'none';
                    break;
            }
        }

        function setupSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'en-US';
                
                recognition.onresult = function(event) {
                    const spoken = event.results[0][0].transcript.toLowerCase().trim();
                    checkSpokenAnswer(spoken);
                };
                
                recognition.onerror = function(event) {
                    document.getElementById('feedback').textContent = 'Speech recognition error. Please try again.';
                    document.getElementById('feedback').className = 'feedback incorrect';
                    document.getElementById('startSpeaking').classList.remove('recording');
                };
                
                recognition.onend = function() {
                    document.getElementById('startSpeaking').classList.remove('recording');
                };
            }
        }

        function startSpeechRecognition() {
            if (recognition) {
                document.getElementById('startSpeaking').classList.add('recording');
                recognition.start();
            } else {
                alert('Speech recognition is not supported in your browser.');
            }
        }

        function playNumberAudio() {
            if (speechSynthesis) {
                const utterance = new SpeechSynthesisUtterance(currentAnswer);
                utterance.lang = 'en-US';
                utterance.rate = 0.8;
                speechSynthesis.speak(utterance);
            } else {
                alert('Speech synthesis is not supported in your browser.');
            }
        }

        function checkSpokenAnswer(spoken) {
            const normalizedSpoken = normalizeAnswer(spoken);
            const normalizedCorrect = normalizeAnswer(currentAnswer);
            
            // Create accepted answers variants
            const acceptedAnswers = [normalizedCorrect];
            const oneVariant = normalizedCorrect
                .replace(/\ba hundred\b/g, 'one hundred')
                .replace(/\ba thousand\b/g, 'one thousand')
                .replace(/\ba million\b/g, 'one million');
            
            if (oneVariant !== normalizedCorrect) {
                acceptedAnswers.push(oneVariant);
            }
            
            // Also accept the numeric form (e.g., "14" for "fourteen")
            const numericAnswer = currentNumber.toString();
            acceptedAnswers.push(numericAnswer);
            
            const feedbackElement = document.getElementById('feedback');
            
            if (acceptedAnswers.includes(normalizedSpoken) || spoken.trim() === numericAnswer) {
                correctCount++;
                totalCount++;
                feedbackElement.textContent = '‚úì Correct! Well done!';
                feedbackElement.className = 'feedback correct';
                updateScores();
                
                // Auto-advance to next number after showing feedback
                setTimeout(() => {
                    generateNewNumber();
                }, 1000);
            } else {
                incorrectCount++;
                totalCount++;
                const correctDisplay = acceptedAnswers.length > 1 
                    ? `"${acceptedAnswers[0]}" or "${acceptedAnswers[1]}" or "${numericAnswer}"` 
                    : `"${acceptedAnswers[0]}" or "${numericAnswer}"`;
                feedbackElement.textContent = `‚úó You said: "${spoken}". Correct: ${correctDisplay}`;
                feedbackElement.className = 'feedback incorrect';
                updateScores();
            }
        }

        function backToStart() {
            showScreen('startScreen');
        }

        function backToDifficulty() {
            showScreen('difficultyScreen');
        }

        function backToMainMenu() {
            window.location.href = '../../index.html';
        }
    </script>
</body>
</html>
